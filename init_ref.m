function [ref, res_prog_i, res_prog_bg] = init_ref(as,cfg)
phys=phys_pkg.phys;
%% IB_FOSC
ref.ib.fosc     = 360E-09;
ref.ib.fosc_nom = 450E-09;

%% VBG
vbg_1v21_target = 1.21;
T = 300.0;
res_prog_bg = round((1.2677 - vbg_1v21_target + 0.0)/1.7e-3);
ref.bg.vout = 1.2677 - res_prog_bg * 1.7e-3 + 0.0 - 1.9062e-5 * (T-23) - 2.0644e-7 * pow2((T-23),2);
res_prog_i  = round(63.0-(ref.bg.vout/38.0*32.0/as.sense.gyr_runit_rppoly_scale/2.5e-6 - as.cm.idac.res_ref(1))/as.cm.idac.res_ref(2));
ref.idac.iout = ref.bg.vout/(sum(as.cm.idac.res_ref.*dec2binvec(cfg.otp.ana.gyr_trm_res_prog_i,6,1))*16/2)*as.sense.gyr_runit_rppoly_scale;

%% VGM
ref.cm.vout = as.cm.vgm((as.cm.vgm(:,1) == cfg.otp.ana.gyr_trm_res_prog_ldovcm), 2)*ref.bg.vout;
ref.cm.filt.SOS = [1.0000 2.0000 1.0000 1.0000 -1.6330 0.6906];
ref.cm.filt.G   = [0.0144 1.0000];

%% Noise Contribution
switch cfg.def.corner
    case 'T'
        % bai430_sim.sim_vref_iref_gyro:maestro [Vnoise_VBGP:TT]
        ref.bg.noise.freq    = [1.000 1.259 1.585 1.995 2.512 3.162 3.981 5.012 6.310 7.943 10.00 ...
            12.59 15.85 19.95 25.12 31.62 39.81 50.12 63.10 79.43 100.0 ...
            125.9 158.5 199.5 251.2 316.2 398.1 501.2 631.0 794.3 1.000E3 ...
            1.259E3 1.585E3 1.995E3 2.512E3 3.162E3 3.981E3 5.012E3 6.310E3 7.943E3 10.00E3 ...
            12.59E3 15.85E3 19.95E3 25.12E3 31.62E3 39.81E3 50.12E3 63.10E3 79.43E3 100.0E3 ...
            125.9E3 158.5E3 199.5E3 251.2E3 316.2E3 398.1E3 501.2E3 631.0E3 794.3E3 1.000E6 ...
            1.259E6 1.585E6 1.995E6 2.512E6 3.162E6 3.981E6 5.012E6 6.310E6 7.943E6 10.00E6];          % Frequencies for bandgap thermal noise [Hz]
        ref.bg.noise.vnd     = [824.5 735.2 656.4 587.0 525.9 472.3 425.3 384.3 348.5 317.5 ...
            290.8 267.8 248.2 231.5 217.5 205.8 196.0 188.0 181.4 176.0 ...
            171.6 168.1 165.2 162.9 161.1 159.6 158.5 157.6 156.8 156.2 ...
            155.8 155.4 155.2 154.9 154.8 154.7 154.7 154.7 154.8 155.1 ...
            155.5 156.2 157.3 159.0 161.3 164.4 168.4 173.0 177.8 181.9 ...
            183.3 178.6 162.8 133.4 99.21 74.02 63.30 60.99 57.83 49.93 ...
            39.78 30.52 23.15 17.50 13.16 9.802 7.211 5.245 3.802 2.794 2.135]*1e-9*sqrt(phys.T/300);  % Bandgap thermal noise [V/rt(Hz)]
        
        % IDAC noise values depends significantly from P and N. Here is used the P side, that is the worst
        % bai430_sim.sim_iref_gyro:maestro [IDAC_noise:TT]
        ref.idac.noise.freq  = [1.000 1.259 1.585 1.995 2.512 3.162 3.981 5.012 6.310 7.943 10.00 ...
            12.59 15.85 19.95 25.12 31.62 39.81 50.12 63.10 79.43 100.0 ...
            125.9 158.5 199.5 251.2 316.2 398.1 501.2 631.0 794.3 1.000E3 ...
            1.259E3 1.585E3 1.995E3 2.512E3 3.162E3 3.981E3 5.012E3 6.310E3 7.943E3 10.00E3 ...
            12.59E3 15.85E3 19.95E3 25.12E3 31.62E3 39.81E3 50.12E3 63.10E3 79.43E3 100.0E3 ...
            125.9E3 158.5E3 199.5E3 251.2E3 316.2E3 398.1E3 501.2E3 631.0E3 794.3E3 1.000E6 ...
            1.259E6 1.585E6 1.995E6 2.512E6 3.162E6 3.981E6 5.012E6 6.310E6 7.943E6 10.00E6 ...
            12.59E6 15.85E6 19.95E6 25.12E6 31.62E6 39.81E6 50.12E6 63.10E6 79.43E6 100.0E6 ...
            125.9E6 158.5E6 199.5E6 251.2E6 316.2E6 398.1E6 501.2E6 631.0E6 794.3E6 1.000E9];          % Frequencies for IDAC thermal noise [Hz]
        
        ref.idac.noise.ind   = [1118.0 993.1 882.4 784.5 698.0 621.5 554.0 494.4 441.9 395.8 ...
            355.2 319.6 288.5 261.3 237.8 217.4 199.9 184.9 172.1 161.3 ...
            152.3 144.7 138.4 133.3 129.0 125.6 122.8 120.5 118.7 117.3 ...
            116.1 115.2 114.4 113.8 113.3 113.0 112.7 112.4 112.2 112.1 ...
            112.0 111.9 111.8 111.7 111.7 111.6 111.6 111.6 111.5 111.4 ...
            111.2 110.9 110.2 109.0 107.4 105.6 104.5 104.2 104.8 106.6 ...
            109.5 114.1 120.9 130.5 143.2 159.2 177.8 197.7 217.1 234.1 ...
            247.3 256.4 261.7 264.4 265.5 265.8 265.4 264.7 263.7 263.0 ...
            263.6 266.7 273.7 286.4 306.8 337.5 381.6 442.6 524.0 630.0 764.5]*1e-15*sqrt(phys.T/300); % IDAC thermal noise without bandgap [A/rt(Hz)]
        
        % bai430_sim.sim_gyro_vgm_model_hv:maestro [output pnoise,Vsqrt(Hz):TT_resprog]
        ref.cm.noise.freq = [1.000 1.259 1.585 1.995 2.512 3.162 3.981 5.012 6.310 7.943 10.00 ...
            12.59 15.85 19.95 25.12 31.62 39.81 50.12 63.10 79.43 100.0 ...
            125.9 158.5 199.5 251.2 316.2 398.1 501.2 631.0 794.3 1.000E3 ...
            1.259E3 1.585E3 1.995E3 2.512E3 3.162E3 3.981E3 5.012E3 6.310E3 7.943E3 10.00E3 ...
            12.59E3 15.85E3 19.95E3 25.12E3 31.62E3 39.81E3 50.12E3 63.10E3 79.43E3 100.0E3];                                     % Frequencies for IDAC thermal noise [Hz]
        ref.cm.noise.vnd = [18.66 16.84 15.21 13.75 12.43 11.25 10.19 9.246 8.399 7.643 ...
            6.969 6.369 5.837 5.366 4.950 4.584 4.262 3.979 3.730 3.509 ...
            3.309 3.126 2.949 2.770 2.580 2.372 2.141 1.891 1.632 1.377 ...
            1.141 932.4 754.0 605.7 484.8 387.4 309.7 248.1 199.6 161.7 ...
            132.4 110.1 93.35 81.19 72.69 67.10 63.83 62.43 62.55 63.97 66.54]*1e-6*sqrt(phys.T/300);  % VCM thermal noise without bandgap [V/rt(Hz)]
        
        ref.cm.noise.fcorner = 10;                                                                                   % LDOVCM Flicker corner frequency [Hz]
        ref.cm.noise.thermal_vnd    = (ref.cm.vout/8)*1.12e-6*sqrt(phys.T/300);                                      % LDOVCM thermal noise [V/rt(Hz)]
        ref.cm.noise.thermal_vnd25k = (ref.cm.vout/8)*225e-9*sqrt(phys.T/300);                                       % LDOVCM noise at 25kHz [V/rt(Hz)]
    case 'S'
        % bai430_sim.sim_vref_iref_gyro:maestro [Vnoise_VBGP:P_29]
        ref.bg.noise.freq = [1.000 1.259 1.585 1.995 2.512 3.162 3.981 5.012 6.310 7.943 10.00 ...
            12.59 15.85 19.95 25.12 31.62 39.81 50.12 63.10 79.43 100.0 ...
            125.9 158.5 199.5 251.2 316.2 398.1 501.2 631.0 794.3 1.000E3 ...
            1.259E3 1.585E3 1.995E3 2.512E3 3.162E3 3.981E3 5.012E3 6.310E3 7.943E3 10.00E3 ...
            12.59E3 15.85E3 19.95E3 25.12E3 31.62E3 39.81E3 50.12E3 63.10E3 79.43E3 100.0E3 ...
            125.9E3 158.5E3 199.5E3 251.2E3 316.2E3 398.1E3 501.2E3 631.0E3 794.3E3 1.000E6 ...
            1.259E6 1.585E6 1.995E6 2.512E6 3.162E6 3.981E6 5.012E6 6.310E6 7.943E6 10.00E6];          % Frequencies for bandgap thermal noise [Hz]
        ref.bg.noise.vnd = [888.1 792.4 708.0 633.5 567.9 510.3 459.8 415.6 377.2 343.8 ...
            315.0 290.2 269.0 251.1 235.9 223.2 212.7 203.9 196.8 190.9 ...
            186.1 182.3 179.2 176.7 174.7 173.1 171.8 170.8 170.0 169.4 ...
            168.9 168.5 168.2 168.0 167.8 167.7 167.7 167.8 168.0 168.4 ...
            169.1 170.1 171.6 173.8 176.7 180.3 184.7 189.3 193.6 196.4 ...
            195.1 184.8 159.2 120.7 85.81 67.60 63.31 61.69 55.82 46.33 ...
            36.55 28.24 21.62 16.42 12.33 9.121 6.654 4.814 3.504 2.626 2.077]*1e-9*sqrt(phys.T/300);  % Bandgap thermal noise [V/rt(Hz)]
        
        %IDAC noise values depends significantly from P and N. Here is used the P side, that is the worst
        % bai430_sim.sim_iref_gyro:maestro [IDAC_noise:SS]
        ref.idac.noise.freq  = [1.000 1.259 1.585 1.995 2.512 3.162 3.981 5.012 6.310 7.943 10.00 ...
            12.59 15.85 19.95 25.12 31.62 39.81 50.12 63.10 79.43 100.0 ...
            125.9 158.5 199.5 251.2 316.2 398.1 501.2 631.0 794.3 1.000E3 ...
            1.259E3 1.585E3 1.995E3 2.512E3 3.162E3 3.981E3 5.012E3 6.310E3 7.943E3 10.00E3 ...
            12.59E3 15.85E3 19.95E3 25.12E3 31.62E3 39.81E3 50.12E3 63.10E3 79.43E3 100.0E3 ...
            125.9E3 158.5E3 199.5E3 251.2E3 316.2E3 398.1E3 501.2E3 631.0E3 794.3E3 1.000E6 ...
            1.259E6 1.585E6 1.995E6 2.512E6 3.162E6 3.981E6 5.012E6 6.310E6 7.943E6 10.00E6 ...
            12.59E6 15.85E6 19.95E6 25.12E6 31.62E6 39.81E6 50.12E6 63.10E6 79.43E6 100.0E6 ...
            125.9E6 158.5E6 199.5E6 251.2E6 316.2E6 398.1E6 501.2E6 631.0E6 794.3E6 1.000E9];          % Frequencies for IDAC thermal noise [Hz]
        ref.idac.noise.ind = [950.4 844.8 751.4 668.6 595.4 530.6 473.3 422.7 378.0 338.6 ...
            304.0 273.5 246.8 223.5 203.1 185.5 170.3 157.2 146.0 136.5 ...
            128.4 121.7 116.1 111.4 107.6 104.5 101.9 99.86 98.18 96.83 ...
            95.75 94.88 94.18 93.62 93.17 92.82 92.53 92.31 92.13 91.98 ...
            91.87 91.78 91.71 91.66 91.62 91.60 91.60 91.61 91.65 91.70 ...
            91.75 91.75 91.56 90.93 89.67 88.09 86.95 86.74 87.53 89.35 ...
            92.39 97.03 103.8 113.2 125.7 141.4 159.7 179.8 199.8 218.0 ...
            233.1 244.1 251.3 255.4 257.2 257.7 257.4 256.6 255.4 254.4 ...
            254.2 256.0 261.0 270.7 287.0 312.1 348.9 400.4 470.0 561.4 678.1]*1e-15*sqrt(phys.T/300); % IDAC thermal noise without bandgap [A/rt(Hz)]
        
        % bai430_sim.sim_gyro_vgm_model_hv:maestro [output pnoise,Vsqrt(Hz):TT_resprog]
        ref.cm.noise.freq = [1.000 1.259 1.585 1.995 2.512 3.162 3.981 5.012 6.310 7.943 10.00 ...
            12.59 15.85 19.95 25.12 31.62 39.81 50.12 63.10 79.43 100.0 ...
            125.9 158.5 199.5 251.2 316.2 398.1 501.2 631.0 794.3 1.000E3 ...
            1.259E3 1.585E3 1.995E3 2.512E3 3.162E3 3.981E3 5.012E3 6.310E3 7.943E3 10.00E3 ...
            12.59E3 15.85E3 19.95E3 25.12E3 31.62E3 39.81E3 50.12E3 63.10E3 79.43E3 100.0E3];                                     % Frequencies for IDAC thermal noise [Hz]
        ref.cm.noise.vnd = [18.66 16.84 15.21 13.75 12.43 11.25 10.19 9.246 8.399 7.643 ...
            6.969 6.369 5.837 5.366 4.950 4.584 4.262 3.979 3.730 3.509 ...
            3.309 3.126 2.949 2.770 2.580 2.372 2.141 1.891 1.632 1.377 ...
            1.141 932.4 754.0 605.7 484.8 387.4 309.7 248.1 199.6 161.7 ...
            132.4 110.1 93.35 81.19 72.69 67.10 63.83 62.43 62.55 63.97 66.54]*1e-6*sqrt(phys.T/300);  % VCM thermal noise without bandgap [V/rt(Hz)]
    case 'F'
        % bai430_sim.sim_vref_iref_gyro:maestro [Vnoise_VBGP:P_0]
        ref.bg.noise.freq = [1.000 1.259 1.585 1.995 2.512 3.162 3.981 5.012 6.310 7.943 10.00 ...
            12.59 15.85 19.95 25.12 31.62 39.81 50.12 63.10 79.43 100.0 ...
            125.9 158.5 199.5 251.2 316.2 398.1 501.2 631.0 794.3 1.000E3 ...
            1.259E3 1.585E3 1.995E3 2.512E3 3.162E3 3.981E3 5.012E3 6.310E3 7.943E3 10.00E3 ...
            12.59E3 15.85E3 19.95E3 25.12E3 31.62E3 39.81E3 50.12E3 63.10E3 79.43E3 100.0E3 ...
            125.9E3 158.5E3 199.5E3 251.2E3 316.2E3 398.1E3 501.2E3 631.0E3 794.3E3 1.000E6 ...
            1.259E6 1.585E6 1.995E6 2.512E6 3.162E6 3.981E6 5.012E6 6.310E6 7.943E6 10.00E6];          % Frequencies for bandgap thermal noise [Hz]
        ref.bg.noise.vnd = [770.1E-9 686.1 612.0 546.7 489.2 438.8 394.6 356.0 322.4 293.3 ...
            268.1 246.5 228.0 212.3 199.1 188.0 178.8 171.2 165.0 159.9 ...
            155.7 152.4 149.7 147.5 145.8 144.4 143.3 142.4 141.8 141.2 ...
            140.8 140.4 140.2 140.0 139.8 139.7 139.7 139.7 139.7 139.9 ...
            140.1 140.6 141.3 142.4 144.0 146.3 149.5 153.6 158.4 163.3 ...
            167.0 167.2 159.8 140.8 112.4 84.57 66.64 59.82 57.81 53.24 ...
            44.30 34.31 25.87 19.41 14.56 10.89 8.079 5.931 4.316 3.144 2.337]*1e-9*sqrt(phys.T/300);  % Bandgap thermal noise [V/rt(Hz)]
        
        %IDAC noise values depends significantly from P and N. Here is used the P side, that is the worst
        % bai430_sim.sim_iref_gyro:maestro [IDAC_noise:FF]
        ref.idac.noise.freq  = [1.000 1.259 1.585 1.995 2.512 3.162 3.981 5.012 6.310 7.943 10.00 ...
            12.59 15.85 19.95 25.12 31.62 39.81 50.12 63.10 79.43 100.0 ...
            125.9 158.5 199.5 251.2 316.2 398.1 501.2 631.0 794.3 1.000E3 ...
            1.259E3 1.585E3 1.995E3 2.512E3 3.162E3 3.981E3 5.012E3 6.310E3 7.943E3 10.00E3 ...
            12.59E3 15.85E3 19.95E3 25.12E3 31.62E3 39.81E3 50.12E3 63.10E3 79.43E3 100.0E3 ...
            125.9E3 158.5E3 199.5E3 251.2E3 316.2E3 398.1E3 501.2E3 631.0E3 794.3E3 1.000E6 ...
            1.259E6 1.585E6 1.995E6 2.512E6 3.162E6 3.981E6 5.012E6 6.310E6 7.943E6 10.00E6 ...
            12.59E6 15.85E6 19.95E6 25.12E6 31.62E6 39.81E6 50.12E6 63.10E6 79.43E6 100.0E6 ...
            125.9E6 158.5E6 199.5E6 251.2E6 316.2E6 398.1E6 501.2E6 631.0E6 794.3E6 1.000E9];          % Frequencies for IDAC thermal noise [Hz]
        ref.idac.noise.ind = [1131 1006 894.6 796.2 709.0 632.0 563.9 503.7 450.6 403.9 ...
            362.7 326.6 295.0 267.4 243.4 222.7 204.8 189.4 176.3 165.3 ...
            156.0 148.2 141.7 136.4 132.0 128.4 125.5 123.2 121.3 119.8 ...
            118.6 117.6 116.8 116.2 115.7 115.3 115.0 114.7 114.5 114.4 ...
            114.2 114.1 114.0 114.0 113.9 113.8 113.8 113.7 113.6 113.4 ...
            113.1 112.5 111.6 110.3 108.6 107.1 106.2 106.2 107.1 109.0 ...
            112.1 116.9 124.0 133.8 146.7 162.7 181.1 200.7 219.5 236.2 ...
            249.3 258.5 264.0 266.9 268.1 268.3 267.9 266.9 265.6 264.4 ...
            264.0 265.7 270.7 280.5 296.9 322.3 359.6 412.0 483.3 577.5 698.8]*1e-15*sqrt(phys.T/300); % IDAC thermal noise without bandgap [A/rt(Hz)]
        
        % bai430_sim.sim_gyro_vgm_model_hv:maestro [output pnoise,Vsqrt(Hz):TT_resprog]
        ref.cm.noise.freq = [1.000 1.259 1.585 1.995 2.512 3.162 3.981 5.012 6.310 7.943 10.00 ...
            12.59 15.85 19.95 25.12 31.62 39.81 50.12 63.10 79.43 100.0 ...
            125.9 158.5 199.5 251.2 316.2 398.1 501.2 631.0 794.3 1.000E3 ...
            1.259E3 1.585E3 1.995E3 2.512E3 3.162E3 3.981E3 5.012E3 6.310E3 7.943E3 10.00E3 ...
            12.59E3 15.85E3 19.95E3 25.12E3 31.62E3 39.81E3 50.12E3 63.10E3 79.43E3 100.0E3];                                     % Frequencies for IDAC thermal noise [Hz]
        ref.cm.noise.vnd = [18.66 16.84 15.21 13.75 12.43 11.25 10.19 9.246 8.399 7.643 ...
            6.969 6.369 5.837 5.366 4.950 4.584 4.262 3.979 3.730 3.509 ...
            3.309 3.126 2.949 2.770 2.580 2.372 2.141 1.891 1.632 1.377 ...
            1.141 932.4 754.0 605.7 484.8 387.4 309.7 248.1 199.6 161.7 ...
            132.4 110.1 93.35 81.19 72.69 67.10 63.83 62.43 62.55 63.97 66.54]*1e-6*sqrt(phys.T/300);  % VCM thermal noise without bandgap [V/rt(Hz)]
end

end

